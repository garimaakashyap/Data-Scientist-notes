# SQL Joins - Complete Guide with Examples

## What are Joins?
Joins combine rows from two or more tables based on a related column between them. Think of it like connecting puzzle pieces from different tables.

## Sample Tables for Examples

```sql
-- Employees Table
CREATE TABLE employees (
    emp_id INT PRIMARY KEY,
    emp_name VARCHAR(50),
    department_id INT,
    salary DECIMAL(10,2)
);

-- Departments Table
CREATE TABLE departments (
    dept_id INT PRIMARY KEY,
    dept_name VARCHAR(50),
    location VARCHAR(50)
);

-- Sample Data
INSERT INTO employees VALUES
(1, 'Alice', 10, 50000),
(2, 'Bob', 20, 60000),
(3, 'Charlie', 10, 55000),
(4, 'Diana', NULL, 45000),
(5, 'Eve', 30, 70000);

INSERT INTO departments VALUES
(10, 'IT', 'New York'),
(20, 'HR', 'London'),
(30, 'Finance', 'Tokyo'),
(40, 'Marketing', 'Paris');
```

## 1. INNER JOIN

**What it does:** Returns only rows that have matching values in both tables.

**Venn Diagram:** Only the overlapping part of two circles.

```sql
-- Basic INNER JOIN
SELECT 
    e.emp_name,
    d.dept_name,
    e.salary
FROM employees e
INNER JOIN departments d 
    ON e.department_id = d.dept_id;

-- Result:
-- Alice    | IT      | 50000
-- Bob      | HR      | 60000
-- Charlie  | IT      | 55000
-- Eve      | Finance | 70000
-- (Diana is excluded - no matching department)
```

**When to use:** When you only want records that exist in both tables.

**Alternative Syntax:**
```sql
-- Old style (still works but not recommended)
SELECT e.emp_name, d.dept_name
FROM employees e, departments d
WHERE e.department_id = d.dept_id;
```

## 2. LEFT JOIN (LEFT OUTER JOIN)

**What it does:** Returns all rows from the left table, and matching rows from the right table. If no match, right side is NULL.

**Venn Diagram:** Entire left circle + overlapping part.

```sql
-- LEFT JOIN
SELECT 
    e.emp_name,
    d.dept_name,
    e.salary
FROM employees e
LEFT JOIN departments d 
    ON e.department_id = d.dept_id;

-- Result:
-- Alice    | IT      | 50000
-- Bob      | HR      | 60000
-- Charlie  | IT      | 55000
-- Diana    | NULL    | 45000  (no department match)
-- Eve      | Finance | 70000
```

**When to use:** When you want all records from the left table, even if they don't have matches in the right table.

**Finding records with no match:**
```sql
-- Employees without departments
SELECT 
    e.emp_name,
    e.salary
FROM employees e
LEFT JOIN departments d 
    ON e.department_id = d.dept_id
WHERE d.dept_id IS NULL;

-- Result:
-- Diana | 45000
```

## 3. RIGHT JOIN (RIGHT OUTER JOIN)

**What it does:** Returns all rows from the right table, and matching rows from the left table. If no match, left side is NULL.

**Venn Diagram:** Entire right circle + overlapping part.

```sql
-- RIGHT JOIN
SELECT 
    e.emp_name,
    d.dept_name,
    d.location
FROM employees e
RIGHT JOIN departments d 
    ON e.department_id = d.dept_id;

-- Result:
-- Alice    | IT       | New York
-- Bob      | HR       | London
-- Charlie  | IT       | New York
-- Eve      | Finance  | Tokyo
-- NULL     | Marketing| Paris  (no employees in Marketing)
```

**When to use:** When you want all records from the right table, even if they don't have matches in the left table.

**Note:** RIGHT JOIN is less commonly used. You can usually rewrite it as a LEFT JOIN by swapping the tables.

## 4. FULL OUTER JOIN

**What it does:** Returns all rows from both tables. If no match, missing side is NULL.

**Venn Diagram:** Both entire circles.

```sql
-- FULL OUTER JOIN
SELECT 
    e.emp_name,
    d.dept_name,
    d.location
FROM employees e
FULL OUTER JOIN departments d 
    ON e.department_id = d.dept_id;

-- Result:
-- Alice    | IT       | New York
-- Bob      | HR       | London
-- Charlie  | IT       | New York
-- Diana    | NULL     | NULL
-- Eve      | Finance  | Tokyo
-- NULL     | Marketing| Paris
```

**When to use:** When you want all records from both tables, regardless of matches.

**Note:** Not all databases support FULL OUTER JOIN (MySQL doesn't). You can simulate it with UNION.

## 5. CROSS JOIN (Cartesian Product)

**What it does:** Returns the Cartesian product - every row from first table combined with every row from second table.

**Venn Diagram:** All possible combinations.

```sql
-- CROSS JOIN
SELECT 
    e.emp_name,
    d.dept_name
FROM employees e
CROSS JOIN departments d;

-- Result: 5 employees × 4 departments = 20 rows
-- Alice  | IT
-- Alice  | HR
-- Alice  | Finance
-- Alice  | Marketing
-- Bob    | IT
-- Bob    | HR
-- ... (all combinations)
```

**When to use:** Rarely! Usually for generating test data or when you need all combinations.

**Warning:** Can create HUGE result sets. Be careful!

## 6. SELF JOIN

**What it does:** Joining a table to itself. Useful for hierarchical data or comparing rows within the same table.

**Example: Employee Manager Relationship**

```sql
-- Employees with Managers Table
CREATE TABLE employees_hierarchy (
    emp_id INT PRIMARY KEY,
    emp_name VARCHAR(50),
    manager_id INT,
    salary DECIMAL(10,2)
);

INSERT INTO employees_hierarchy VALUES
(1, 'Alice', NULL, 100000),    -- CEO (no manager)
(2, 'Bob', 1, 80000),         -- Reports to Alice
(3, 'Charlie', 1, 75000),     -- Reports to Alice
(4, 'Diana', 2, 60000),       -- Reports to Bob
(5, 'Eve', 2, 55000);         -- Reports to Bob

-- Self Join: Find employees and their managers
SELECT 
    e.emp_name AS employee,
    m.emp_name AS manager,
    e.salary
FROM employees_hierarchy e
LEFT JOIN employees_hierarchy m 
    ON e.manager_id = m.emp_id;

-- Result:
-- employee | manager | salary
-- Alice    | NULL    | 100000
-- Bob      | Alice   | 80000
-- Charlie  | Alice   | 75000
-- Diana    | Bob     | 60000
-- Eve      | Bob     | 55000
```

**When to use:** 
- Hierarchical data (org charts, categories)
- Comparing rows in the same table
- Finding relationships within a table

## 7. Multiple Table Joins

**Joining 3 or more tables:**

```sql
-- Orders, Customers, Products Example
CREATE TABLE orders (
    order_id INT PRIMARY KEY,
    customer_id INT,
    product_id INT,
    quantity INT,
    order_date DATE
);

CREATE TABLE customers (
    customer_id INT PRIMARY KEY,
    customer_name VARCHAR(50),
    city VARCHAR(50)
);

CREATE TABLE products (
    product_id INT PRIMARY KEY,
    product_name VARCHAR(50),
    price DECIMAL(10,2)
);

-- Join all three tables
SELECT 
    c.customer_name,
    p.product_name,
    o.quantity,
    o.quantity * p.price AS total_amount,
    o.order_date
FROM orders o
INNER JOIN customers c 
    ON o.customer_id = c.customer_id
INNER JOIN products p 
    ON o.product_id = p.product_id
ORDER BY o.order_date;
```

## 8. Join Conditions

### Using ON Clause (Recommended)
```sql
SELECT *
FROM table1 t1
JOIN table2 t2 ON t1.id = t2.id;
```

### Using WHERE Clause (Old Style)
```sql
SELECT *
FROM table1 t1, table2 t2
WHERE t1.id = t2.id;
```

### Multiple Conditions
```sql
SELECT *
FROM employees e
JOIN departments d 
    ON e.department_id = d.dept_id
    AND d.location = 'New York'
    AND e.salary > 50000;
```

### Non-Equi Joins
```sql
-- Join on inequality
SELECT 
    e1.emp_name AS employee1,
    e2.emp_name AS employee2,
    e1.salary AS salary1,
    e2.salary AS salary2
FROM employees e1
JOIN employees e2 
    ON e1.salary < e2.salary
WHERE e1.department_id = e2.department_id;
```

## 9. Join Performance Tips

### 1. Use Indexes
```sql
-- Create index on join column
CREATE INDEX idx_dept_id ON employees(department_id);
CREATE INDEX idx_dept_id ON departments(dept_id);
```

### 2. Join Order Matters
- Join smaller tables first
- Filter early with WHERE before joining

### 3. Avoid SELECT *
```sql
-- Bad
SELECT * FROM employees e
JOIN departments d ON e.department_id = d.dept_id;

-- Good
SELECT e.emp_name, d.dept_name 
FROM employees e
JOIN departments d ON e.department_id = d.dept_id;
```

## 10. Common Join Mistakes

### Mistake 1: Forgetting WHERE in Old Syntax
```sql
-- WRONG - Creates Cartesian product!
SELECT * FROM employees, departments;

-- CORRECT
SELECT * FROM employees, departments
WHERE employees.department_id = departments.dept_id;
```

### Mistake 2: Ambiguous Column Names
```sql
-- WRONG - Which id?
SELECT id, name FROM table1 JOIN table2 ON table1.id = table2.id;

-- CORRECT - Use table aliases
SELECT t1.id, t1.name, t2.name 
FROM table1 t1 
JOIN table2 t2 ON t1.id = t2.id;
```

### Mistake 3: Using WHERE Instead of ON
```sql
-- WRONG - Filters after join (less efficient)
SELECT * FROM employees e
LEFT JOIN departments d ON e.department_id = d.dept_id
WHERE d.dept_name = 'IT';

-- CORRECT - Filter in ON clause for LEFT JOIN
SELECT * FROM employees e
LEFT JOIN departments d 
    ON e.department_id = d.dept_id 
    AND d.dept_name = 'IT';
```

## 11. Visual Summary

```
INNER JOIN:     [Table A] ∩ [Table B]  (overlap only)
LEFT JOIN:      [Table A] ∪ (overlap)  (all A + matches)
RIGHT JOIN:     (overlap) ∪ [Table B]  (all B + matches)
FULL OUTER:     [Table A] ∪ [Table B]  (everything)
CROSS JOIN:     [Table A] × [Table B]  (all combinations)
```

## 12. Practice Examples

### Example 1: Find employees in IT department
```sql
SELECT e.emp_name, e.salary
FROM employees e
INNER JOIN departments d 
    ON e.department_id = d.dept_id
WHERE d.dept_name = 'IT';
```

### Example 2: Departments with no employees
```sql
SELECT d.dept_name, d.location
FROM departments d
LEFT JOIN employees e 
    ON d.dept_id = e.department_id
WHERE e.emp_id IS NULL;
```

### Example 3: Employees earning more than their department average
```sql
SELECT 
    e1.emp_name,
    e1.salary,
    AVG(e2.salary) AS dept_avg_salary
FROM employees e1
JOIN employees e2 
    ON e1.department_id = e2.department_id
GROUP BY e1.emp_id, e1.emp_name, e1.salary
HAVING e1.salary > AVG(e2.salary);
```

## Key Takeaways

1. **INNER JOIN**: Only matching records (most common)
2. **LEFT JOIN**: All left records + matches (very common)
3. **RIGHT JOIN**: All right records + matches (rarely used)
4. **FULL OUTER JOIN**: All records from both tables
5. **CROSS JOIN**: All combinations (use carefully!)
6. **SELF JOIN**: Join table to itself (for hierarchies)
7. Always use table aliases for clarity
8. Use indexes on join columns for performance
9. Prefer ON clause over WHERE for join conditions
10. Test your joins with sample data first!

