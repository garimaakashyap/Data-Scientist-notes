# Power BI Advanced - Complete Guide

## 1. Advanced DAX Patterns

### Time Intelligence Patterns

**Moving Averages**
```dax
MA 7 Days = 
AVERAGEX(
    DATESINPERIOD(
        Date[Date],
        MAX(Date[Date]),
        -7,
        DAY
    ),
    [Total Sales]
)
```

**Year-over-Year Growth**
```dax
YoY Growth = 
VAR CurrentYear = [Total Sales]
VAR PreviousYear = CALCULATE(
    [Total Sales],
    SAMEPERIODLASTYEAR(Date[Date])
)
RETURN
    DIVIDE(CurrentYear - PreviousYear, PreviousYear)
```

**Running Totals**
```dax
Running Total = 
CALCULATE(
    [Total Sales],
    FILTER(
        ALLSELECTED(Date[Date]),
        Date[Date] <= MAX(Date[Date])
    )
)
```

**Period Comparisons**
```dax
vs Previous Period = 
VAR Current = [Total Sales]
VAR Previous = CALCULATE(
    [Total Sales],
    DATEADD(Date[Date], -1, MONTH)
)
RETURN
    Current - Previous
```

### Advanced Filter Context

**Context Transition**
```dax
// Understanding context transition
Row Total = SUMX(
    Sales,
    CALCULATE(SUM(Sales[Amount]))  // Context transition happens here
)
```

**KEEPFILTERS**
```dax
Sales with Filters = 
CALCULATE(
    [Total Sales],
    KEEPFILTERS(Sales[Category] = "Electronics")
)
```

**CROSSFILTER**
```dax
Bidirectional Filter = 
CALCULATE(
    [Total Sales],
    CROSSFILTER(Sales[CustomerID], Customers[CustomerID], BOTH)
)
```

### Advanced Calculations

**Dynamic Top N**
```dax
Top N Sales = 
VAR N = [Top N Parameter]
VAR TopNProducts = 
    TOPN(
        N,
        ALL(Products[ProductName]),
        [Total Sales]
    )
RETURN
    CALCULATE(
        [Total Sales],
        TopNProducts
    )
```

**Percent of Total**
```dax
% of Total = 
DIVIDE(
    [Total Sales],
    CALCULATE(
        [Total Sales],
        ALLSELECTED()
    )
)
```

**Ranking**
```dax
Sales Rank = 
RANKX(
    ALL(Products[ProductName]),
    [Total Sales],
    ,
    DESC,
    DENSE
)
```

**Percentile**
```dax
Sales Percentile = 
PERCENTILEX.INC(
    ALL(Sales),
    Sales[Amount],
    0.9
)
```

### Advanced Pattern: Basket Analysis

**Products Bought Together**
```dax
Basket Analysis = 
VAR CurrentProduct = SELECTEDVALUE(Products[ProductID])
VAR CustomersBought = 
    CALCULATETABLE(
        VALUES(Sales[CustomerID]),
        Sales[ProductID] = CurrentProduct
    )
RETURN
    CALCULATE(
        DISTINCTCOUNT(Sales[ProductID]),
        Sales[CustomerID] IN CustomersBought,
        Sales[ProductID] <> CurrentProduct
    )
```

## 2. Advanced Data Modeling

### Calculation Groups

**What are Calculation Groups?**
- Reusable calculation patterns
- Apply to multiple measures
- Simplify DAX code

**Creating Calculation Groups:**
1. External Tools → Tabular Editor
2. Create Calculation Group
3. Add Calculation Items
4. Define expressions

**Example:**
```dax
// Calculation Item: Current
SELECTEDMEASURE()

// Calculation Item: Previous Year
CALCULATE(
    SELECTEDMEASURE(),
    SAMEPERIODLASTYEAR(Date[Date])
)
```

### Aggregation Tables

**What are Aggregation Tables?**
- Pre-aggregated data
- Faster query performance
- Automatic rollup

**Creating Aggregations:**
1. Modeling tab → Manage Aggregations
2. Select table
3. Define aggregations:
   - Sum, Count, Min, Max, Average
4. Map to detail table

**Benefits:**
- Faster queries
- Reduced model size
- Better performance

### Composite Models

**What are Composite Models?**
- Combine Import and DirectQuery
- Mix storage modes
- Flexible architecture

**Use Cases:**
- Large fact tables (DirectQuery)
- Small dimensions (Import)
- Best of both worlds

**Creating Composite Model:**
1. Set table storage mode
2. Import for dimensions
3. DirectQuery for large facts
4. Power BI handles joins

### Incremental Refresh

**What is Incremental Refresh?**
- Refresh only new/changed data
- Faster refresh times
- Lower resource usage

**Setting Up:**
1. Configure incremental refresh policy
2. Set date range parameters
3. Define refresh window
4. Schedule refresh

**Benefits:**
- Faster refreshes
- Lower costs
- Better performance

## 3. Advanced Power Query (M Language)

### Advanced M Patterns

**Custom Functions**
```m
// Create reusable function
(TableName as table, ColumnName as text) =>
let
    Source = Table.SelectColumns(TableName, {ColumnName}),
    DistinctValues = List.Distinct(Table.Column(Source, ColumnName))
in
    DistinctValues
```

**Error Handling**
```m
try [Column1] otherwise 0
```

**Conditional Logic**
```m
if [Amount] > 1000 then "High" else "Low"
```

**List Operations**
```m
List.Transform({1,2,3}, each _ * 2)
List.Select({1,2,3,4,5}, each _ > 2)
List.Accumulate({1,2,3}, 0, (state, current) => state + current)
```

### Advanced Data Transformations

**Fuzzy Matching**
```m
Table.FuzzyJoin(
    Table1,
    {"Column1"},
    Table2,
    {"Column2"},
    [IgnoreCase=true, Threshold=0.8]
)
```

**Web Scraping**
```m
Web.Contents("https://example.com/data"),
Html.Table(_, {{"Column", "selector"}})
```

**API Integration**
```m
Json.Document(Web.Contents("https://api.example.com/data"))
```

**Custom Connectors**
- Create custom data connectors
- Extend Power Query capabilities
- Reusable across reports

## 4. Performance Tuning

### Query Performance

**Analyze Performance:**
1. View tab → Performance Analyzer
2. Refresh visuals
3. See query times
4. Identify bottlenecks

**Optimization Techniques:**
- Reduce calculated columns
- Optimize measures
- Use aggregations
- Filter early

### Model Optimization

**VertiPaq Analyzer:**
- Analyze model size
- Identify optimization opportunities
- Column cardinality
- Compression ratios

**Best Practices:**
- Remove high-cardinality columns
- Use appropriate data types
- Create hierarchies
- Optimize relationships

### Measure Performance

**Variables for Performance:**
```dax
// Good: Uses variables
Optimized Measure = 
VAR TotalSales = SUM(Sales[Amount])
VAR TotalCost = SUM(Sales[Cost])
VAR Profit = TotalSales - TotalCost
RETURN
    Profit
```

**Avoid Expensive Functions:**
- Minimize ALL() usage
- Use ALLSELECTED when possible
- Cache results with variables
- Test with Performance Analyzer

## 5. Advanced Visualizations

### Custom Visual Development

**Power BI Visuals SDK:**
- Develop custom visuals
- Use TypeScript/JavaScript
- Deploy to AppSource
- Share with community

**Tools:**
- Power BI Visuals Tools
- Visual Studio Code
- Node.js

### R/Python Visuals

**R Visuals:**
1. Add R visual
2. Write R script
3. Use ggplot2, plotly, etc.
4. Interactive R charts

**Python Visuals:**
1. Add Python visual
2. Write Python script
3. Use matplotlib, seaborn, plotly
4. Advanced analytics

**Example R:**
```r
library(ggplot2)
ggplot(dataset, aes(x=Category, y=Sales)) +
    geom_bar(stat="identity")
```

**Example Python:**
```python
import matplotlib.pyplot as plt
plt.bar(dataset['Category'], dataset['Sales'])
plt.show()
```

### Advanced Formatting

**Custom Format Strings:**
```dax
// Dynamic formatting
Formatted Value = 
FORMAT([Total Sales], 
    IF([Total Sales] > 1000000, 
        "$#,##0.0,,\"M\"", 
        "$#,##0.0,\"K\""
    )
)
```

**Conditional Formatting with DAX:**
```dax
// Color based on value
Color Measure = 
SWITCH(
    TRUE(),
    [Sales] > 1000, "#00FF00",  // Green
    [Sales] > 500, "#FFFF00",   // Yellow
    "#FF0000"                   // Red
)
```

## 6. Advanced Security

### Row-Level Security (RLS) Patterns

**Dynamic RLS**
```dax
// Based on user attributes
[Region] = LOOKUPVALUE(
    Users[Region],
    Users[Email], USERPRINCIPALNAME()
)
```

**Hierarchical RLS**
```dax
// Manager sees team data
[Manager] = USERPRINCIPALNAME() ||
[Manager] IN 
    CALCULATETABLE(
        VALUES(Users[Email]),
        Users[Manager] = USERPRINCIPALNAME()
    )
```

**Time-Based RLS**
```dax
// Restrict to current period
Date[Date] >= TODAY() - 90
```

### Object-Level Security

**What is OLS?**
- Hide tables/columns
- Restrict measure access
- Fine-grained control

**Implementation:**
- Use Analysis Services
- Define OLS rules
- Apply to roles

## 7. Advanced Deployment

### Deployment Pipelines

**What are Pipelines?**
- Dev → Test → Prod
- Automated deployment
- Version control
- Change management

**Setting Up:**
1. Create workspaces
2. Set up pipeline
3. Configure stages
4. Deploy reports

### CI/CD Integration

**Azure DevOps:**
- Source control
- Automated builds
- Deployment automation
- Version management

**GitHub Actions:**
- Automated workflows
- Deployment pipelines
- Quality checks

### Best Practices:**
- Version control
- Automated testing
- Staged deployments
- Documentation

## 8. Advanced Analytics

### AI Visuals

**Key Influencers:**
- Identify factors affecting metrics
- Automatic analysis
- Statistical insights

**Decomposition Tree:**
- Break down metrics
- Identify contributors
- Interactive exploration

**Q&A Visual:**
- Natural language queries
- Automatic visual generation
- Conversational BI

### Advanced Analytics Functions

**Forecasting:**
```dax
// Time series forecasting
Forecast = 
FORECAST.ETS(
    Date[Date],
    [Total Sales],
    Date[Date],
    12  // Forecast 12 periods
)
```

**Clustering:**
- Automatic clustering
- Group similar items
- Identify patterns

**Anomaly Detection:**
- Detect outliers
- Unusual patterns
- Data quality issues

## 9. Power BI Service Advanced Features

### Dataflows

**What are Dataflows?**
- Reusable data preparation
- Shared across workspaces
- Self-service ETL

**Creating Dataflows:**
1. Workspace → New → Dataflow
2. Define entities
3. Transform data
4. Schedule refresh

**Benefits:**
- Reusability
- Consistency
- Governance
- Performance

### Datamarts

**What are Datamarts?**
- Self-service analytics
- No-code data modeling
- Automatic optimization

**Features:**
- Visual query builder
- Automatic relationships
- SQL endpoint
- Full Power BI capabilities

### Power BI Premium Features

**Premium Per User (PPU):**
- Advanced features
- Per-user licensing
- No capacity required

**Premium Capacity:**
- Dedicated resources
- Advanced features
- Large scale deployment

**Features:**
- Paginated reports
- AI capabilities
- Advanced dataflows
- XMLA endpoints

## 10. Advanced Integration

### Power Automate Integration

**Automated Workflows:**
- Trigger on data refresh
- Send notifications
- Update other systems
- Automated actions

**Use Cases:**
- Alert on threshold
- Export to SharePoint
- Send email reports
- Update databases

### Power Apps Integration

**Embed Power BI:**
- Embed reports in apps
- Interactive dashboards
- Mobile experiences

**Data Integration:**
- Power Apps → Power BI
- Real-time updates
- Bidirectional sync

### REST API

**Power BI REST API:**
- Programmatic access
- Automation
- Integration
- Custom solutions

**Common Operations:**
- Refresh datasets
- Create reports
- Manage workspaces
- Export data

**Example:**
```python
import requests

# Refresh dataset
url = "https://api.powerbi.com/v1.0/myorg/datasets/{datasetId}/refreshes"
headers = {"Authorization": "Bearer {token}"}
response = requests.post(url, headers=headers)
```

## 11. Advanced Troubleshooting

### DAX Debugging

**DAX Formatter:**
- Format DAX code
- Improve readability
- Best practices

**DAX Studio:**
- Query performance
- Server timings
- Query plans
- Optimization

**Common Issues:**
- Context transition
- Filter context
- Circular dependencies
- Performance problems

### Data Refresh Issues

**Troubleshooting:**
- Check data source connectivity
- Verify credentials
- Review error messages
- Check query performance

**Common Solutions:**
- Update data source
- Fix query errors
- Optimize queries
- Schedule refresh

### Performance Issues

**Diagnosis:**
- Use Performance Analyzer
- Check query times
- Identify slow visuals
- Analyze model size

**Solutions:**
- Optimize measures
- Reduce visual count
- Use aggregations
- Filter data

## 12. Best Practices Summary

### Development Best Practices

1. **Version Control**
   - Use source control
   - Document changes
   - Track versions

2. **Naming Conventions**
   - Consistent naming
   - Clear descriptions
   - Follow standards

3. **Documentation**
   - Document measures
   - Explain logic
   - User guides

4. **Testing**
   - Test all scenarios
   - Validate calculations
   - Performance testing

### Deployment Best Practices

1. **Staged Deployment**
   - Dev → Test → Prod
   - Test thoroughly
   - Rollback plan

2. **Governance**
   - Access control
   - Data quality
   - Compliance

3. **Monitoring**
   - Track usage
   - Monitor performance
   - User feedback

## Key Takeaways

1. **Advanced DAX:** Complex patterns, time intelligence, calculations
2. **Data Modeling:** Calculation groups, aggregations, composite models
3. **Power Query M:** Advanced transformations, custom functions
4. **Performance:** Optimization techniques, monitoring
5. **Advanced Visuals:** Custom visuals, R/Python integration
6. **Security:** Advanced RLS patterns, object-level security
7. **Deployment:** Pipelines, CI/CD, automation
8. **Integration:** APIs, Power Automate, Power Apps
9. **Analytics:** AI visuals, forecasting, clustering
10. **Troubleshooting:** Debugging, performance, refresh issues

---

*Master these advanced techniques to become a Power BI expert!*

