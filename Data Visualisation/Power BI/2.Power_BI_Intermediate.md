# Power BI Intermediate - Complete Guide

## 1. Advanced DAX Functions

### Time Intelligence Functions

**TOTALYTD (Year-to-Date)**
```dax
YTD Sales = TOTALYTD(SUM(Sales[Amount]), Sales[Date])
```
- Calculates year-to-date total

**TOTALQTD (Quarter-to-Date)**
```dax
QTD Sales = TOTALQTD(SUM(Sales[Amount]), Sales[Date])
```
- Calculates quarter-to-date total

**TOTALMTD (Month-to-Date)**
```dax
MTD Sales = TOTALMTD(SUM(Sales[Amount]), Sales[Date])
```
- Calculates month-to-date total

**SAMEPERIODLASTYEAR**
```dax
PY Sales = CALCULATE(
    SUM(Sales[Amount]),
    SAMEPERIODLASTYEAR(Sales[Date])
)
```
- Compares to same period last year

**PREVIOUSYEAR**
```dax
Previous Year = CALCULATE(
    SUM(Sales[Amount]),
    PREVIOUSYEAR(Sales[Date])
)
```
- Previous year total

**DATESBETWEEN**
```dax
Last 30 Days = CALCULATE(
    SUM(Sales[Amount]),
    DATESBETWEEN(
        Sales[Date],
        TODAY() - 30,
        TODAY()
    )
)
```
- Values between two dates

**DATEDIFF**
```dax
Days Since Order = DATEDIFF(Sales[OrderDate], TODAY(), DAY)
```
- Calculate difference between dates

### Filter Functions

**FILTER**
```dax
High Value Sales = CALCULATE(
    SUM(Sales[Amount]),
    FILTER(Sales, Sales[Amount] > 1000)
)
```
- Applies filter condition

**ALL**
```dax
Total All Products = CALCULATE(
    SUM(Sales[Amount]),
    ALL(Products)
)
```
- Removes filters from table/column

**ALLEXCEPT**
```dax
Total by Region = CALCULATE(
    SUM(Sales[Amount]),
    ALLEXCEPT(Sales, Sales[Region])
)
```
- Removes all filters except specified

**ALLSELECTED**
```dax
Selected Total = CALCULATE(
    SUM(Sales[Amount]),
    ALLSELECTED()
)
```
- Respects user selections

**RELATED**
```dax
Customer Name = RELATED(Customers[Name])
```
- Gets related value from another table

**RELATEDTABLE**
```dax
Customer Orders = COUNTROWS(RELATEDTABLE(Orders))
```
- Gets related table rows

### Aggregation Functions

**SUMX**
```dax
Total with Tax = SUMX(
    Sales,
    Sales[Amount] * (1 + Sales[TaxRate])
)
```
- Iterates and sums expression

**AVERAGEX**
```dax
Average Order Value = AVERAGEX(
    Sales,
    Sales[Amount]
)
```
- Calculates average of expression

**COUNTX**
```dax
Orders > 1000 = COUNTX(
    Sales,
    IF(Sales[Amount] > 1000, 1, 0)
)
```
- Counts rows meeting condition

**MAXX / MINX**
```dax
Max Order = MAXX(Sales, Sales[Amount])
Min Order = MINX(Sales, Sales[Amount])
```
- Maximum/minimum of expression

### Logical Functions

**SWITCH**
```dax
Sales Category = SWITCH(
    TRUE(),
    Sales[Amount] > 1000, "High",
    Sales[Amount] > 500, "Medium",
    "Low"
)
```
- Multiple conditions (better than nested IF)

**AND / OR**
```dax
High Priority = IF(
    AND(Sales[Amount] > 1000, Sales[Status] = "Active"),
    "Yes",
    "No"
)
```
- Logical operators

**ISBLANK**
```dax
Has Value = IF(ISBLANK(Sales[Amount]), "No", "Yes")
```
- Check if value is blank

### Text Functions

**CONCATENATE / CONCATENATEX**
```dax
Full Name = CONCATENATE(Customers[FirstName], " ", Customers[LastName])

Product List = CONCATENATEX(
    Sales,
    Sales[ProductName],
    ", "
)
```
- Combine text values

**LEFT / RIGHT / MID**
```dax
First 3 = LEFT(Products[Code], 3)
Last 5 = RIGHT(Products[Code], 5)
Middle = MID(Products[Code], 2, 4)
```
- Extract parts of text

**UPPER / LOWER / PROPER**
```dax
Upper = UPPER(Customers[Name])
Lower = LOWER(Customers[Name])
Proper = PROPER(Customers[Name])
```
- Change text case

## 2. Advanced Data Modeling

### Star Schema Design

**Fact Tables:**
- Contains measures (numbers to sum)
- Many rows
- Foreign keys to dimensions
- Example: Sales, Orders, Transactions

**Dimension Tables:**
- Contains attributes (descriptions)
- Fewer rows
- Primary keys
- Example: Customers, Products, Dates, Geography

**Benefits:**
- Better performance
- Easier to understand
- Flexible analysis
- Standard BI pattern

### Creating Date Table

**Why Date Table?**
- Enables time intelligence
- Consistent date hierarchy
- Holiday/weekend handling

**Creating Date Table:**
```dax
Date Table = 
ADDCOLUMNS(
    CALENDAR(DATE(2020,1,1), DATE(2025,12,31)),
    "Year", YEAR([Date]),
    "Month", MONTH([Date]),
    "Month Name", FORMAT([Date], "MMMM"),
    "Quarter", "Q" & FORMAT([Date], "Q"),
    "Weekday", WEEKDAY([Date]),
    "Weekday Name", FORMAT([Date], "DDDD"),
    "Is Weekend", IF(WEEKDAY([Date]) IN {1,7}, 1, 0)
)
```

**Mark as Date Table:**
1. Right-click Date table
2. Mark as Date Table
3. Select date column

### Role-Playing Dimensions

**Scenario:** Same table used multiple times
- Example: OrderDate and ShipDate both reference Date table

**Solution:**
1. Create multiple relationships
2. Set one as active, others inactive
3. Use USERELATIONSHIP in measures:
```dax
Sales by Ship Date = CALCULATE(
    SUM(Sales[Amount]),
    USERELATIONSHIP(Sales[ShipDate], Date[Date])
)
```

### Many-to-Many Relationships

**Challenge:** Many-to-many relationships need bridge table

**Solution:**
1. Create bridge/intersection table
2. Connect through bridge
3. Use bidirectional filtering carefully

**Example:**
- Students ↔ Courses (many-to-many)
- Create: StudentCourses bridge table
- Students → StudentCourses → Courses

## 3. Advanced Visualizations

### Custom Visuals

**Installing Custom Visuals:**
1. Visualizations pane → Get more visuals
2. Browse AppSource
3. Click "Add" to install

**Popular Custom Visuals:**
- Chiclet Slicer
- Timeline
- Bullet Chart
- KPI Indicator
- Word Cloud
- Gantt Chart

### Drill-Through Pages

**Creating Drill-Through:**
1. Create detail page
2. Add drill-through fields:
   - Fields pane → Drill through
   - Drag fields to drill-through area
3. Add "Back" button
4. Use in other visuals:
   - Right-click → Drill through

**Use Cases:**
- Detailed view of summary
- Transaction details
- Customer profiles

### Bookmarks

**Creating Bookmarks:**
1. View tab → Bookmarks pane
2. Set up desired view
3. Click "Add" in Bookmarks pane
4. Name the bookmark

**Bookmark Actions:**
- Data: Captures current filter state
- Display: Captures visual visibility
- Current page: Captures current page

**Using Bookmarks:**
- Add buttons to navigate
- Create interactive navigation
- Build guided experiences

### Tooltips

**Creating Tooltips:**
1. Create tooltip page
2. Design tooltip visualization
3. Set page as tooltip:
   - Format visual → Tooltip
   - Select tooltip page

**Advanced Tooltips:**
- Show detailed information
- Include images
- Multiple visuals
- Conditional tooltips

### What-If Parameters

**Creating What-If:**
1. Modeling tab → New Parameter
2. Set name, data type, range
3. Creates slider and measure

**Example:**
```dax
Discount % = 'Discount Parameter'[Discount Parameter Value]

Discounted Price = Sales[Price] * (1 - [Discount %])
```

**Use Cases:**
- Scenario analysis
- Sensitivity analysis
- Interactive calculations

## 4. Advanced Power Query

### M Language Basics

**What is M?**
- Power Query's formula language
- Used in Advanced Editor
- Functional programming language

**Basic M Syntax:**
```m
let
    Source = Excel.Workbook(File.Contents("C:\Data.xlsx")),
    Sheet1 = Source{[Item="Sheet1"]}[Data],
    #"Promoted Headers" = Table.PromoteHeaders(Sheet1)
in
    #"Promoted Headers"
```

### Common M Functions

**Table Functions:**
```m
Table.SelectRows(Table, each [Column] > 100)
Table.AddColumn(Table, "NewColumn", each [Column1] + [Column2])
Table.RemoveColumns(Table, {"Column1", "Column2"})
Table.Sort(Table, {{"Column", Order.Ascending}})
```

**List Functions:**
```m
List.Sum({1, 2, 3, 4, 5})
List.Average({1, 2, 3, 4, 5})
List.Max({1, 2, 3, 4, 5})
```

**Text Functions:**
```m
Text.Upper("hello")
Text.Lower("HELLO")
Text.Trim("  text  ")
Text.Replace("Hello", "H", "J")
```

### Advanced Transformations

**Unpivot Columns:**
- Transform tab → Unpivot Columns
- Converts columns to rows
- Useful for wide data

**Pivot Columns:**
- Transform tab → Pivot Column
- Converts rows to columns
- Creates summary table

**Merge Queries:**
1. Home tab → Merge Queries
2. Select two tables
3. Choose matching columns
4. Select join kind:
   - Left Outer
   - Right Outer
   - Inner
   - Full Outer

**Append Queries:**
1. Home tab → Append Queries
2. Combine multiple tables
3. Stack rows together

**Group By:**
- Transform tab → Group By
- Aggregate data
- Create summaries

### Parameters

**Creating Parameters:**
1. Home tab → Manage Parameters
2. New Parameter
3. Set name, type, value
4. Use in queries:
```m
Excel.Workbook(File.Contents(Parameter1))
```

**Use Cases:**
- File paths
- Server names
- Date ranges
- Dynamic connections

## 5. Performance Optimization

### Data Model Optimization

**1. Remove Unnecessary Columns**
- Delete unused columns
- Reduces model size
- Faster processing

**2. Optimize Data Types**
- Use smallest appropriate type
- Text vs Number
- Date vs DateTime

**3. Create Summarized Tables**
- Pre-aggregate when possible
- Reduce row count
- Faster queries

**4. Proper Relationships**
- Use correct cardinality
- Avoid unnecessary relationships
- Set cross-filter direction appropriately

### Measure Optimization

**Avoid Calculated Columns for Aggregations:**
```dax
// Bad: Calculated column
Sales[Total] = Sales[Quantity] * Sales[Price]

// Good: Measure
Total Sales = SUMX(Sales, Sales[Quantity] * Sales[Price])
```

**Use Variables:**
```dax
// Better performance
Sales Measure = 
VAR TotalAmount = SUM(Sales[Amount])
VAR TotalCost = SUM(Sales[Cost])
RETURN
    TotalAmount - TotalCost
```

**Avoid Nested CALCULATE:**
- Simplify CALCULATE statements
- Use variables for clarity
- Test performance

### Query Optimization

**1. Filter Early**
- Apply filters in Power Query
- Reduce data volume
- Faster refresh

**2. Remove Unnecessary Steps**
- Clean up Applied Steps
- Combine transformations
- Remove redundant steps

**3. Use Query Folding**
- Let database do work
- Push transformations to source
- Check with "View Native Query"

## 6. Advanced Filtering

### Slicers

**Visual Slicers:**
- Add slicer visual
- Connect to fields
- Users can filter interactively

**Slicer Types:**
- List
- Dropdown
- Between
- Relative date

**Formatting Slicers:**
- Single select vs multi-select
- Show "Select all" option
- Customize appearance

### Advanced Filters

**Relative Date Filters:**
- Last N days/weeks/months
- Next N periods
- This period
- Custom ranges

**Top N Filters:**
- Top N by value
- Bottom N by value
- Based on measure
- Dynamic N value

**Include/Exclude Filters:**
- Keep specific values
- Remove specific values
- Complex conditions

### Cross-Filtering

**Edit Interactions:**
1. Format tab → Edit interactions
2. Control how visuals interact
3. Options:
   - Filter
   - Highlight
   - None

**Use Cases:**
- Some visuals filter others
- Some only highlight
- Some don't interact

## 7. Advanced Formatting

### Themes

**Applying Themes:**
1. View tab → Themes
2. Browse themes
3. Apply or customize

**Custom Themes:**
1. Create custom theme
2. Save as JSON file
3. Apply to reports

**Theme Components:**
- Colors
- Fonts
- Visual styles
- Backgrounds

### Conditional Formatting

**Advanced Conditional Formatting:**
- Color scales
- Data bars
- Icons
- Field value rules

**DAX-Based Formatting:**
```dax
// Conditional color measure
Color = IF([Sales] > 1000, "Green", "Red")
```

### Custom Format Strings

**Number Formats:**
- Currency: $#,##0.00
- Percentage: 0.00%
- Thousands: #,##0,"K"
- Millions: #,##0,,"M"

**Date Formats:**
- Short: MM/DD/YYYY
- Long: MMMM DD, YYYY
- Custom: "Q" & FORMAT([Date], "Q")

## 8. Row-Level Security (RLS)

### What is RLS?
Row-Level Security restricts data access based on user roles.

### Creating Roles

**Steps:**
1. Modeling tab → Manage Roles
2. Create role
3. Add DAX filter:
```dax
[Region] = USERPRINCIPALNAME()
```
4. Assign users to role

### RLS Patterns

**User-Based:**
```dax
[Salesperson] = USERPRINCIPALNAME()
```

**Department-Based:**
```dax
[Department] = LOOKUPVALUE(
    Users[Department],
    Users[Email], USERPRINCIPALNAME()
)
```

**Hierarchical:**
```dax
[Manager] = USERPRINCIPALNAME() ||
[Manager] IN RELATEDTABLE(Users[Manager])
```

### Testing RLS

**View As:**
1. Modeling tab → View As
2. Select role
3. Test security
4. Verify data visibility

## Key Takeaways

1. **Advanced DAX:** Time intelligence, filter functions, iterators
2. **Data Modeling:** Star schema, date tables, relationships
3. **Advanced Visuals:** Custom visuals, drill-through, bookmarks
4. **Power Query M:** Transform data with M language
5. **Performance:** Optimize model, measures, queries
6. **Filtering:** Advanced slicers, cross-filtering
7. **Formatting:** Themes, conditional formatting
8. **Security:** Row-level security for data protection

---

*Master these intermediate techniques for professional Power BI reports!*

