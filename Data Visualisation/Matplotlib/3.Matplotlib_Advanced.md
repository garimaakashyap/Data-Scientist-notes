# Matplotlib Advanced - Complete Guide

## 1. Object-Oriented API (Best Practice)

### Understanding the OOP Approach

```python
import matplotlib.pyplot as plt
import numpy as np

# Recommended: Explicit figure and axes
fig, ax = plt.subplots(figsize=(10, 6))

x = np.linspace(0, 10, 100)
y = np.sin(x)

ax.plot(x, y, label='sin(x)')
ax.set_xlabel('X')
ax.set_ylabel('Y')
ax.set_title('OOP Style')
ax.legend()
ax.grid(True)

plt.show()
```

### Multiple Figures

```python
# Create multiple figures
fig1, ax1 = plt.subplots(figsize=(8, 6))
fig2, ax2 = plt.subplots(figsize=(8, 6))

x = np.linspace(0, 10, 100)

# Figure 1
ax1.plot(x, np.sin(x))
ax1.set_title('Figure 1')

# Figure 2
ax2.plot(x, np.cos(x))
ax2.set_title('Figure 2')

plt.show()
```

### Accessing Figure and Axes Properties

```python
fig, ax = plt.subplots(figsize=(10, 6))

# Access figure properties
print(f"Figure size: {fig.get_size_inches()}")
print(f"Figure DPI: {fig.dpi}")

# Access axes properties
print(f"X limits: {ax.get_xlim()}")
print(f"Y limits: {ax.get_ylim()}")

# Set properties programmatically
ax.set_xlim(0, 10)
ax.set_ylim(-2, 2)
```

## 2. Custom Artists and Patches

### Creating Custom Shapes

```python
from matplotlib.patches import Rectangle, Circle, Polygon, Arrow
import matplotlib.patches as mpatches

fig, ax = plt.subplots(figsize=(10, 8))

# Rectangle
rect = Rectangle((1, 1), 2, 3, facecolor='blue', alpha=0.5, edgecolor='black')
ax.add_patch(rect)

# Circle
circle = Circle((5, 5), 1.5, facecolor='red', alpha=0.5, edgecolor='black')
ax.add_patch(circle)

# Polygon
polygon = Polygon([(7, 1), (9, 3), (8, 5), (6, 4)], 
                  facecolor='green', alpha=0.5, edgecolor='black')
ax.add_patch(polygon)

# Arrow
arrow = mpatches.FancyArrowPatch((2, 6), (4, 7),
                                arrowstyle='->', mutation_scale=20,
                                color='purple', linewidth=2)
ax.add_patch(arrow)

ax.set_xlim(0, 10)
ax.set_ylim(0, 10)
ax.set_aspect('equal')
ax.set_title('Custom Shapes')
ax.grid(True, alpha=0.3)
plt.show()
```

### Custom Paths

```python
from matplotlib.path import Path
import matplotlib.patches as patches

# Define custom path
verts = [
    (0., 0.),   # Start
    (1., 0.),   # Line to
    (1., 1.),   # Line to
    (0., 1.),   # Line to
    (0., 0.),   # Close
]

codes = [
    Path.MOVETO,
    Path.LINETO,
    Path.LINETO,
    Path.LINETO,
    Path.CLOSEPOLY,
]

path = Path(verts, codes)
patch = patches.PathPatch(path, facecolor='orange', alpha=0.5)

fig, ax = plt.subplots(figsize=(8, 8))
ax.add_patch(patch)
ax.set_xlim(-1, 2)
ax.set_ylim(-1, 2)
ax.set_aspect('equal')
plt.show()
```

## 3. Advanced Text and LaTeX

### LaTeX Rendering

```python
fig, ax = plt.subplots(figsize=(10, 6))
x = np.linspace(0, 10, 100)

ax.plot(x, np.sin(x), label=r'$\sin(x)$')
ax.plot(x, np.cos(x), label=r'$\cos(x)$')

# LaTeX in labels
ax.set_xlabel(r'$x$ (radians)', fontsize=14)
ax.set_ylabel(r'$y = f(x)$', fontsize=14)
ax.set_title(r'Trigonometric Functions: $y = \sin(x)$ and $y = \cos(x)$', fontsize=16)

# LaTeX in text
ax.text(5, 0.5, r'$\int_0^{2\pi} \sin(x) dx = 0$', fontsize=14,
        bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.5))

ax.legend(fontsize=12)
ax.grid(True, alpha=0.3)
plt.show()
```

### Advanced Text Formatting

```python
fig, ax = plt.subplots(figsize=(10, 6))

# Different text styles
texts = [
    ('Normal text', (1, 5), {}),
    ('Bold text', (1, 4), {'weight': 'bold'}),
    ('Italic text', (1, 3), {'style': 'italic'}),
    ('Large text', (1, 2), {'size': 20}),
    ('Colored text', (1, 1), {'color': 'red'}),
]

for text, pos, style in texts:
    ax.text(pos[0], pos[1], text, **style, fontsize=12)

ax.set_xlim(0, 10)
ax.set_ylim(0, 6)
ax.set_title('Text Formatting Examples')
plt.show()
```

## 4. Advanced Subplot Configurations

### Subplot2grid

```python
from matplotlib.gridspec import GridSpec

fig = plt.figure(figsize=(12, 10))
gs = GridSpec(3, 3, figure=fig, hspace=0.3, wspace=0.3)

# Large plot spanning multiple cells
ax1 = fig.add_subplot(gs[0, :])
ax1.plot(np.random.randn(100))
ax1.set_title('Top Plot (Full Width)')

# Middle plots
ax2 = fig.add_subplot(gs[1, 0])
ax2.bar(['A', 'B'], [10, 20])
ax2.set_title('Middle Left')

ax3 = fig.add_subplot(gs[1, 1:])
ax3.scatter(np.random.randn(50), np.random.randn(50))
ax3.set_title('Middle Right (Wide)')

# Bottom plots
ax4 = fig.add_subplot(gs[2, :2])
ax4.hist(np.random.randn(1000), bins=30)
ax4.set_title('Bottom Left (Wide)')

ax5 = fig.add_subplot(gs[2, 2])
ax5.pie([30, 40, 30], labels=['A', 'B', 'C'])
ax5.set_title('Bottom Right')

plt.show()
```

### Nested Subplots

```python
from matplotlib.gridspec import GridSpec, GridSpecFromSubplotSpec

fig = plt.figure(figsize=(12, 8))
gs = GridSpec(2, 2, figure=fig)

# Main subplot
ax_main = fig.add_subplot(gs[0, :])
ax_main.plot(np.random.randn(100))
ax_main.set_title('Main Plot')

# Nested subplots
gs_nested = GridSpecFromSubplotSpec(1, 2, subplot_spec=gs[1, :])

ax1 = fig.add_subplot(gs_nested[0, 0])
ax1.bar(['A', 'B'], [10, 20])

ax2 = fig.add_subplot(gs_nested[0, 1])
ax2.scatter(np.random.randn(50), np.random.randn(50))

plt.show()
```

## 5. Advanced Color Mapping

### Custom Colormaps

```python
from matplotlib.colors import LinearSegmentedColormap, ListedColormap
import matplotlib.colors as mcolors

# Method 1: From list of colors
colors = ['#FF0000', '#FFFF00', '#00FF00', '#00FFFF', '#0000FF']
n_bins = 100
cmap1 = LinearSegmentedColormap.from_list('custom1', colors, N=n_bins)

# Method 2: Listed colormap
cmap2 = ListedColormap(['red', 'green', 'blue'])

# Method 3: From existing colormap
from matplotlib import cm
cmap3 = cm.get_cmap('viridis', 8)  # Discrete version

# Use colormaps
fig, axes = plt.subplots(1, 3, figsize=(15, 4))
data = np.random.rand(10, 10)

axes[0].imshow(data, cmap=cmap1)
axes[0].set_title('Custom Linear Colormap')

axes[1].imshow(data, cmap=cmap2)
axes[1].set_title('Listed Colormap')

axes[2].imshow(data, cmap=cmap3)
axes[2].set_title('Discrete Colormap')

plt.tight_layout()
plt.show()
```

### Colorbar Customization

```python
fig, ax = plt.subplots(figsize=(10, 6))

data = np.random.rand(10, 10)
im = ax.imshow(data, cmap='viridis')

# Custom colorbar
cbar = plt.colorbar(im, ax=ax, orientation='horizontal', pad=0.1)
cbar.set_label('Custom Label', rotation=0, labelpad=20)
cbar.set_ticks([0, 0.5, 1])
cbar.set_ticklabels(['Low', 'Medium', 'High'])

plt.show()
```

## 6. Animation

### Basic Animation

```python
import matplotlib.animation as animation

fig, ax = plt.subplots(figsize=(10, 6))
x = np.linspace(0, 2*np.pi, 100)
line, = ax.plot(x, np.sin(x))
ax.set_ylim(-1.5, 1.5)
ax.set_xlabel('X')
ax.set_ylabel('Y')
ax.set_title('Animated Sine Wave')
ax.grid(True)

def animate(frame):
    line.set_ydata(np.sin(x + frame/10))
    return line,

ani = animation.FuncAnimation(fig, animate, frames=100, interval=50, blit=True)
plt.show()

# To save animation:
# ani.save('animation.gif', writer='pillow')
```

### Multiple Animated Elements

```python
fig, ax = plt.subplots(figsize=(10, 6))
ax.set_xlim(0, 10)
ax.set_ylim(-2, 2)
ax.grid(True)

x = np.linspace(0, 10, 100)
line1, = ax.plot(x, np.sin(x), label='sin(x)')
line2, = ax.plot(x, np.cos(x), label='cos(x)')
ax.legend()

def animate(frame):
    line1.set_ydata(np.sin(x + frame/10))
    line2.set_ydata(np.cos(x + frame/10))
    return line1, line2

ani = animation.FuncAnimation(fig, animate, frames=100, interval=50, blit=True)
plt.show()
```

## 7. Event Handling

### Mouse Events

```python
class MouseEventHandler:
    def __init__(self, ax):
        self.ax = ax
        self.points = []
        self.line, = ax.plot([], [], 'ro-')
        ax.figure.canvas.mpl_connect('button_press_event', self.on_click)
        
    def on_click(self, event):
        if event.inaxes != self.ax:
            return
        self.points.append((event.xdata, event.ydata))
        if len(self.points) > 1:
            x, y = zip(*self.points)
            self.line.set_data(x, y)
            self.ax.figure.canvas.draw()

fig, ax = plt.subplots(figsize=(10, 6))
ax.set_xlim(0, 10)
ax.set_ylim(0, 10)
ax.set_title('Click to add points')
handler = MouseEventHandler(ax)
plt.show()
```

### Keyboard Events

```python
class KeyboardHandler:
    def __init__(self, ax):
        self.ax = ax
        self.x = np.linspace(0, 10, 100)
        self.y = np.sin(self.x)
        self.line, = ax.plot(self.x, self.y)
        ax.figure.canvas.mpl_connect('key_press_event', self.on_key)
        
    def on_key(self, event):
        if event.key == 'up':
            self.y *= 1.1
        elif event.key == 'down':
            self.y *= 0.9
        self.line.set_ydata(self.y)
        self.ax.figure.canvas.draw()

fig, ax = plt.subplots(figsize=(10, 6))
ax.set_title('Press Up/Down arrows to scale')
handler = KeyboardHandler(ax)
plt.show()
```

## 8. Advanced 3D Plotting

### 3D Contour Plot

```python
from mpl_toolkits.mplot3d import Axes3D

fig = plt.figure(figsize=(12, 5))

# 3D surface
ax1 = fig.add_subplot(121, projection='3d')
x = np.linspace(-5, 5, 50)
y = np.linspace(-5, 5, 50)
X, Y = np.meshgrid(x, y)
Z = np.sin(np.sqrt(X**2 + Y**2))

surf = ax1.plot_surface(X, Y, Z, cmap='viridis', alpha=0.8)
ax1.set_xlabel('X')
ax1.set_ylabel('Y')
ax1.set_zlabel('Z')

# 2D contour
ax2 = fig.add_subplot(122)
contour = ax2.contour(X, Y, Z, levels=20)
ax2.clabel(contour, inline=True, fontsize=8)
ax2.set_xlabel('X')
ax2.set_ylabel('Y')
ax2.set_aspect('equal')

plt.tight_layout()
plt.show()
```

### 3D Wireframe

```python
fig = plt.figure(figsize=(10, 8))
ax = fig.add_subplot(111, projection='3d')

x = np.linspace(-5, 5, 30)
y = np.linspace(-5, 5, 30)
X, Y = np.meshgrid(x, y)
Z = np.sin(np.sqrt(X**2 + Y**2))

ax.plot_wireframe(X, Y, Z, color='blue', alpha=0.6)
ax.set_xlabel('X')
ax.set_ylabel('Y')
ax.set_zlabel('Z')
ax.set_title('3D Wireframe')
plt.show()
```

## 9. Custom Transformations

### Custom Coordinate Systems

```python
from matplotlib.transforms import Affine2D
import matplotlib.patches as mpatches

fig, ax = plt.subplots(figsize=(10, 8))

# Create custom transformation
trans = Affine2D().rotate_deg(45) + ax.transData

# Plot with transformation
x = np.linspace(0, 5, 100)
y = np.sin(x)
ax.plot(x, y, transform=trans, label='Rotated')

ax.set_xlim(-2, 7)
ax.set_ylim(-2, 7)
ax.set_aspect('equal')
ax.grid(True, alpha=0.3)
ax.legend()
plt.show()
```

## 10. Performance Optimization

### Using Backends

```python
# For faster rendering, use different backends
import matplotlib
matplotlib.use('Agg')  # Non-interactive backend (faster)

# Or for interactive
matplotlib.use('TkAgg')  # Tkinter backend
```

### Efficient Plotting

```python
# Use set_data instead of replotting
fig, ax = plt.subplots(figsize=(10, 6))
x = np.linspace(0, 10, 1000)
y = np.sin(x)

line, = ax.plot(x, y)  # Store line object

# Update data efficiently
for i in range(100):
    y_new = np.sin(x + i/10)
    line.set_ydata(y_new)  # Faster than replotting
    ax.figure.canvas.draw()
    plt.pause(0.01)
```

## 11. Export and Publishing

### High-Quality Export

```python
fig, ax = plt.subplots(figsize=(10, 6))
x = np.linspace(0, 10, 100)
ax.plot(x, np.sin(x))
ax.set_title('High Quality Plot')

# Export with different formats and settings
plt.savefig('plot.png', dpi=300, bbox_inches='tight', facecolor='white')
plt.savefig('plot.pdf', bbox_inches='tight')
plt.savefig('plot.svg', bbox_inches='tight')  # Vector format
plt.savefig('plot.jpg', dpi=300, quality=95, bbox_inches='tight')
```

### Publication-Ready Plots

```python
# Set publication style
plt.rcParams.update({
    'font.size': 12,
    'font.family': 'serif',
    'axes.linewidth': 1.5,
    'xtick.major.width': 1.5,
    'ytick.major.width': 1.5,
    'figure.dpi': 300,
    'savefig.dpi': 300,
    'savefig.bbox': 'tight'
})

fig, ax = plt.subplots(figsize=(8, 6))
x = np.linspace(0, 10, 100)
ax.plot(x, np.sin(x), linewidth=2, label=r'$\sin(x)$')
ax.set_xlabel('X (radians)', fontsize=14)
ax.set_ylabel('Y', fontsize=14)
ax.set_title('Publication Quality Plot', fontsize=16)
ax.legend(fontsize=12)
ax.grid(True, alpha=0.3)

plt.savefig('publication_plot.png')
plt.show()
```

## 12. Integration with Other Libraries

### Matplotlib with Pandas

```python
import pandas as pd

# Create DataFrame
df = pd.DataFrame({
    'x': np.linspace(0, 10, 100),
    'y1': np.sin(np.linspace(0, 10, 100)),
    'y2': np.cos(np.linspace(0, 10, 100))
})

# Plot directly from DataFrame
fig, ax = plt.subplots(figsize=(10, 6))
df.plot(x='x', y=['y1', 'y2'], ax=ax)
ax.set_title('Pandas Integration')
plt.show()
```

### Matplotlib with Seaborn Style

```python
import seaborn as sns

# Use seaborn style
sns.set_style("whitegrid")

fig, ax = plt.subplots(figsize=(10, 6))
x = np.linspace(0, 10, 100)
ax.plot(x, np.sin(x), label='sin(x)')
ax.plot(x, np.cos(x), label='cos(x)')
ax.legend()
ax.set_title('Seaborn Style')
plt.show()
```

## 13. Advanced Customization

### Custom Tickers and Formatters

```python
from matplotlib.ticker import FuncFormatter, MultipleLocator

fig, ax = plt.subplots(figsize=(10, 6))
x = np.linspace(0, 100, 100)
y = np.sin(x/10)

ax.plot(x, y)

# Custom formatter
def format_func(value, tick_number):
    return f'{value:.1f}%'

ax.xaxis.set_major_formatter(FuncFormatter(format_func))
ax.xaxis.set_major_locator(MultipleLocator(20))

ax.set_xlabel('Percentage')
ax.set_ylabel('Value')
plt.show()
```

### Custom Spines

```python
fig, ax = plt.subplots(figsize=(10, 6))
x = np.linspace(0, 10, 100)
ax.plot(x, np.sin(x))

# Customize spines
ax.spines['top'].set_visible(False)
ax.spines['right'].set_visible(False)
ax.spines['left'].set_linewidth(2)
ax.spines['bottom'].set_linewidth(2)

# Move spines
ax.spines['left'].set_position(('outward', 10))
ax.spines['bottom'].set_position(('outward', 10))

plt.show()
```

## Key Takeaways

1. **OOP API:** Always use explicit figure and axes objects
2. **Custom artists:** Use patches for custom shapes
3. **LaTeX:** Use `r'$...$'` for mathematical notation
4. **Animations:** Use `FuncAnimation` for dynamic plots
5. **Events:** Connect to mouse/keyboard events for interactivity
6. **Performance:** Use `set_data()` instead of replotting
7. **Export:** Use high DPI and `bbox_inches='tight'` for quality
8. **Customization:** Modify spines, ticks, and formatters for fine control
9. **Integration:** Works seamlessly with Pandas and Seaborn
10. **3D:** Use `mplot3d` for advanced 3D visualizations

## Best Practices

1. **Always use OOP API** for complex plots
2. **Set figure size** before creating plots
3. **Use tight_layout()** to prevent label overlap
4. **Save with high DPI** (300+) for publications
5. **Use vector formats** (PDF, SVG) when possible
6. **Customize styles** for consistent appearance
7. **Optimize performance** for large datasets
8. **Add proper labels** and legends
9. **Use appropriate colormaps** for data type
10. **Test on different backends** if needed

---

*Master these advanced techniques to create professional, publication-quality visualizations!*

